from mip import Model, xsum, minimize, BINARY, Var, LinExpr, maximize
from model import DeploymentRequirement, AwsInstanceType
from typing import List
from datetime import datetime

#I'm just lazy to type this everytime
def rlen(something):
    return range(len(something))

class MipModel:

    def __init__(self, available_instances: [AwsInstanceType], requirements: List[DeploymentRequirement]):
        self.available_instances = available_instances
        self.requirements = requirements

    def calculate(self):

        print(f"***********{datetime.now()}*******Begin calculation:")

        model = Model("model")

        # worst-case scenario - we need 1 separate instance for every pod
        placement_matrix = [[[model.add_var(var_type=BINARY)
                       for pod in rlen(self.requirements)]
                       for instance in rlen(self.requirements)]
                       for type in rlen(self.available_instances)]

        # instance is in use only if at least 1 pod use it as a host
        instances_in_use = [[model.add_var(var_type=BINARY) for instance in rlen(self.requirements) ]
                            for type in rlen(self.available_instances)]

        instance_requirements_ram = [[xsum([placement_matrix[type][instance][pod]*self.requirements[pod].ram
                                            for pod in rlen(self.requirements)])
                                      for instance in rlen(self.requirements)]
                                     for type in rlen(self.available_instances)]

        instance_requirements_cpu = [[xsum([placement_matrix[type][instance][pod]*self.requirements[pod].cpu
                                            for pod in rlen(self.requirements)])
                                      for instance in rlen(self.requirements)]
                                     for type in rlen(self.available_instances)]

        model.objective = minimize(xsum([(self.available_instances[type].price * instances_in_use[type][instance])
                                         for instance in rlen(self.requirements)
                                         for type in rlen(self.available_instances)]))

        # every pod should be placed exactly one time
        for pod in rlen(self.requirements):
            model += xsum([placement_matrix[type][instance][pod]
                          for instance in rlen(self.requirements)
                          for type in rlen(self.available_instances)]) == 1


        for type in rlen(self.available_instances):
            for instance in rlen(self.requirements):

                model += instance_requirements_ram[type][instance] <= self.available_instances[type].ram
                model += instance_requirements_cpu[type][instance] <= self.available_instances[type].cpu

                # This is actually just `y = 1 if E(x)>0 else 0`
                #  E (x) / n <= y <= (n - 1 + E(x))/n
                model += instances_in_use[type][instance] >= xsum(placement_matrix[type][instance]) / len(self.requirements)
                model += instances_in_use[type][instance] <= (len(self.requirements) - 1 + xsum(placement_matrix[type][instance]))/len(self.requirements)

                for pod in rlen(self.requirements):
                    # fit by ram
                    model += self.available_instances[type].ram >= placement_matrix[type][instance][pod] * requirements[pod].ram

                    # fit by cpu
                    model += self.available_instances[type].cpu >= placement_matrix[type][instance][pod] * requirements[pod].cpu

        model.verbose = True
        model.optimize(max_seconds=60*60)

        print(f"***********{datetime.now()}*******Result:")

        for type in rlen(self.available_instances):

            #print(f"In use: {[i.x for i in instances_in_use[type]]}")
            for instance in rlen(self.requirements):
                #print(f"{[i.x for i in placement_matrix[type][instance]]}")
                if instance_requirements_ram[type][instance].x > 0 or instance_requirements_cpu[type][instance].x > 0:
                    print("")
                    print(f"{self.available_instances[type]} N {instance} Total booked capacity {instance_requirements_ram[type][instance].x} ram, {instance_requirements_cpu[type][instance].x} cpu:")

                    assert instance_requirements_ram[type][instance].x <= self.available_instances[type].ram
                    assert instance_requirements_cpu[type][instance].x <= self.available_instances[type].cpu

                    for pod in rlen(self.requirements):
                        if placement_matrix[type][instance][pod].x > 0:
                            print(f"- Pod number {pod} {self.requirements[pod]}")

available_instances = [AwsInstanceType(name='i3en.3xlarge', ram=98304, cpu=12, price=6.496), AwsInstanceType(name='r5n.12xlarge', ram=393216, cpu=48, price=3.706), AwsInstanceType(name='r5dn.8xlarge', ram=262144, cpu=32, price=2.99732), AwsInstanceType(name='m6id.2xlarge', ram=32768, cpu=8, price=1.5996), AwsInstanceType(name='i2.2xlarge', ram=62464, cpu=8, price=1.972), AwsInstanceType(name='r6g.medium', ram=8192, cpu=1, price=0.0504), AwsInstanceType(name='c6id.8xlarge', ram=65536, cpu=32, price=1.7378), AwsInstanceType(name='m6id.xlarge', ram=16384, cpu=4, price=0.31733), AwsInstanceType(name='m5a.2xlarge', ram=32768, cpu=8, price=0.733), AwsInstanceType(name='d3en.8xlarge', ram=131072, cpu=32, price=9.51776), AwsInstanceType(name='x2iedn.2xlarge', ram=262144, cpu=8, price=1.83398), AwsInstanceType(name='i4i.16xlarge', ram=524288, cpu=64, price=10.066), AwsInstanceType(name='m5n.16xlarge', ram=262144, cpu=64, price=30.982), AwsInstanceType(name='g5.24xlarge', ram=393216, cpu=96, price=8.274), AwsInstanceType(name='r6id.12xlarge', ram=393216, cpu=48, price=3.99168), AwsInstanceType(name='c6i.24xlarge', ram=196608, cpu=96, price=44.904), AwsInstanceType(name='m6id.32xlarge', ram=524288, cpu=128, price=15.6448), AwsInstanceType(name='i4i.metal', ram=1048576, cpu=128, price=13.146), AwsInstanceType(name='m5dn.xlarge', ram=16384, cpu=4, price=0.184), AwsInstanceType(name='r6a.12xlarge', ram=393216, cpu=48, price=5.7408), AwsInstanceType(name='c5d.2xlarge', ram=16384, cpu=8, price=0.65), AwsInstanceType(name='m5ad.2xlarge', ram=32768, cpu=8, price=1.537), AwsInstanceType(name='m5.24xlarge', ram=393216, cpu=96, price=4.608), AwsInstanceType(name='c5ad.xlarge', ram=8192, cpu=4, price=0.373), AwsInstanceType(name='c5n.large', ram=5376, cpu=2, price=0.449), AwsInstanceType(name='t2.micro', ram=1024, cpu=1, price=0.0162), AwsInstanceType(name='c6a.8xlarge', ram=65536, cpu=32, price=1.349), AwsInstanceType(name='m5zn.3xlarge', ram=49152, cpu=12, price=1.2201), AwsInstanceType(name='m5d.24xlarge', ram=393216, cpu=96, price=17.074), AwsInstanceType(name='r5dn.xlarge', ram=32768, cpu=4, price=0.422), AwsInstanceType(name='r5b.large', ram=16384, cpu=2, price=1.741), AwsInstanceType(name='m5n.metal', ram=393216, cpu=96, price=7.474), AwsInstanceType(name='r5n.24xlarge', ram=786432, cpu=96, price=43.152), AwsInstanceType(name='r5dn.metal', ram=786432, cpu=96, price=8.181), AwsInstanceType(name='c5.12xlarge', ram=98304, cpu=48, price=7.93), AwsInstanceType(name='d3.2xlarge', ram=65536, cpu=8, price=2.224), AwsInstanceType(name='c5.large', ram=4096, cpu=2, price=0.662), AwsInstanceType(name='x2idn.32xlarge', ram=2097152, cpu=128, price=28.698), AwsInstanceType(name='c5.metal', ram=196608, cpu=96, price=40.08), AwsInstanceType(name='m5d.12xlarge', ram=196608, cpu=48, price=2.712), AwsInstanceType(name='r5ad.xlarge', ram=32768, cpu=4, price=1.762), AwsInstanceType(name='r6gd.16xlarge', ram=524288, cpu=64, price=3.8114), AwsInstanceType(name='r5n.xlarge', ram=32768, cpu=4, price=1.816), AwsInstanceType(name='x2iezn.12xlarge', ram=1572864, cpu=48, price=10.173), AwsInstanceType(name='c5d.xlarge', ram=8192, cpu=4, price=0.455), AwsInstanceType(name='a1.metal', ram=32768, cpu=16, price=0.408), AwsInstanceType(name='m5zn.metal', ram=196608, cpu=48, price=4.0891), AwsInstanceType(name='x1e.16xlarge', ram=1998848, cpu=64, price=22.358), AwsInstanceType(name='g5.16xlarge', ram=262144, cpu=64, price=4.226), AwsInstanceType(name='r5ad.16xlarge', ram=524288, cpu=64, price=4.609), AwsInstanceType(name='r6a.4xlarge', ram=131072, cpu=16, price=2.91792), AwsInstanceType(name='i4i.large', ram=16384, cpu=2, price=0.189), AwsInstanceType(name='c5.9xlarge', ram=73728, cpu=36, price=1.66), AwsInstanceType(name='m5.2xlarge', ram=32768, cpu=8, price=1.712), AwsInstanceType(name='g3s.xlarge', ram=31232, cpu=4, price=0.898), AwsInstanceType(name='c6id.2xlarge', ram=16384, cpu=8, price=3.44352), AwsInstanceType(name='m6a.24xlarge', ram=393216, cpu=96, price=4.69192), AwsInstanceType(name='x2iedn.32xlarge', ram=4194304, cpu=128, price=42.036), AwsInstanceType(name='r5a.8xlarge', ram=262144, cpu=32, price=13.917), AwsInstanceType(name='r6a.16xlarge', ram=524288, cpu=64, price=7.6544), AwsInstanceType(name='i3en.metal', ram=786432, cpu=96, price=12.47), AwsInstanceType(name='i3.4xlarge', ram=124928, cpu=16, price=1.775), AwsInstanceType(name='u-9tb1.112xlarge', ram=9437184, cpu=448, price=102.508)]
requirements = [DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=32, cpu=0.05), DeploymentRequirement(ram=32, cpu=0.05), DeploymentRequirement(ram=32, cpu=0.05), DeploymentRequirement(ram=3072, cpu=1.024), DeploymentRequirement(ram=3072, cpu=1.024), DeploymentRequirement(ram=32, cpu=0.15), DeploymentRequirement(ram=75, cpu=0.2), DeploymentRequirement(ram=75, cpu=0.2), DeploymentRequirement(ram=556, cpu=0.1), DeploymentRequirement(ram=1156, cpu=0.55), DeploymentRequirement(ram=3054, cpu=2.098), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=3054, cpu=3.122), DeploymentRequirement(ram=3054, cpu=3.122), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=1006, cpu=0.55), DeploymentRequirement(ram=1006, cpu=0.55), DeploymentRequirement(ram=1006, cpu=0.55), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=256, cpu=0.05), DeploymentRequirement(ram=256, cpu=0.05), DeploymentRequirement(ram=5248, cpu=1), DeploymentRequirement(ram=5248, cpu=1), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=2048, cpu=0.2), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=15342, cpu=5.170000000000001), DeploymentRequirement(ram=1024, cpu=0.5), DeploymentRequirement(ram=1024, cpu=0.17), DeploymentRequirement(ram=1024, cpu=0.17), DeploymentRequirement(ram=1024, cpu=0.17), DeploymentRequirement(ram=400, cpu=0.075), DeploymentRequirement(ram=1024, cpu=0.17), DeploymentRequirement(ram=1024, cpu=0.17), DeploymentRequirement(ram=1024, cpu=0.17), DeploymentRequirement(ram=8192, cpu=0.17), DeploymentRequirement(ram=128, cpu=0.1), DeploymentRequirement(ram=576, cpu=0.16), DeploymentRequirement(ram=512, cpu=0.128), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=256, cpu=0.128), DeploymentRequirement(ram=256, cpu=0.128), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=50, cpu=0.075), DeploymentRequirement(ram=50, cpu=0.075), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=50, cpu=0.075), DeploymentRequirement(ram=50, cpu=0.075), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=200, cpu=0.1), DeploymentRequirement(ram=32, cpu=0.15), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=100, cpu=0.005), DeploymentRequirement(ram=250, cpu=0.075), DeploymentRequirement(ram=250, cpu=0.075), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=356, cpu=0.1), DeploymentRequirement(ram=250, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=1006, cpu=0.55), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=128, cpu=0.128), DeploymentRequirement(ram=614, cpu=0.65), DeploymentRequirement(ram=614, cpu=0.65), DeploymentRequirement(ram=614, cpu=0.65), DeploymentRequirement(ram=32, cpu=0.2), DeploymentRequirement(ram=32, cpu=0.2), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=20, cpu=0.01), DeploymentRequirement(ram=544, cpu=0.25), DeploymentRequirement(ram=544, cpu=0.25), DeploymentRequirement(ram=406, cpu=0.15000000000000002), DeploymentRequirement(ram=406, cpu=0.15000000000000002), DeploymentRequirement(ram=416, cpu=0.25), DeploymentRequirement(ram=256, cpu=0.05), DeploymentRequirement(ram=0, cpu=0.256), DeploymentRequirement(ram=0, cpu=0.256), DeploymentRequirement(ram=2048, cpu=1.5), DeploymentRequirement(ram=2048, cpu=1.5), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=100, cpu=0.2), DeploymentRequirement(ram=256, cpu=0.256), DeploymentRequirement(ram=100, cpu=0.1), DeploymentRequirement(ram=512, cpu=0.256), DeploymentRequirement(ram=1024, cpu=0.512), DeploymentRequirement(ram=0, cpu=1.024), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0.512), DeploymentRequirement(ram=4096, cpu=4.096), DeploymentRequirement(ram=1024, cpu=1), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=1280, cpu=0.55), DeploymentRequirement(ram=1280, cpu=0.55), DeploymentRequirement(ram=1280, cpu=0.55), DeploymentRequirement(ram=1280, cpu=0.55), DeploymentRequirement(ram=1280, cpu=0.55), DeploymentRequirement(ram=1280, cpu=0.55), DeploymentRequirement(ram=1280, cpu=0.55), DeploymentRequirement(ram=1280, cpu=0.55), DeploymentRequirement(ram=1280, cpu=0.55), DeploymentRequirement(ram=1280, cpu=0.55), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=500, cpu=0.5), DeploymentRequirement(ram=500, cpu=0.09), DeploymentRequirement(ram=500, cpu=0.09), DeploymentRequirement(ram=500, cpu=0.09), DeploymentRequirement(ram=500, cpu=0.09), DeploymentRequirement(ram=500, cpu=0.09), DeploymentRequirement(ram=1000, cpu=0.09), DeploymentRequirement(ram=1000, cpu=0.09), DeploymentRequirement(ram=1000, cpu=0.09), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=25600, cpu=1), DeploymentRequirement(ram=25600, cpu=1), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=5248, cpu=1), DeploymentRequirement(ram=5248, cpu=1), DeploymentRequirement(ram=5248, cpu=1), DeploymentRequirement(ram=5248, cpu=1), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=1024, cpu=0.075), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=1024, cpu=0.075), DeploymentRequirement(ram=1024, cpu=0.075), DeploymentRequirement(ram=1024, cpu=0.075), DeploymentRequirement(ram=512, cpu=0.2), DeploymentRequirement(ram=512, cpu=0.075), DeploymentRequirement(ram=7168, cpu=0.25), DeploymentRequirement(ram=7168, cpu=0.25), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=3578, cpu=3.048), DeploymentRequirement(ram=3578, cpu=3.048), DeploymentRequirement(ram=3578, cpu=3.048), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=32, cpu=0.15), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=256, cpu=0.1), DeploymentRequirement(ram=256, cpu=0.1), DeploymentRequirement(ram=128, cpu=0.2), DeploymentRequirement(ram=500, cpu=0.1), DeploymentRequirement(ram=500, cpu=0.5), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=500, cpu=0.5), DeploymentRequirement(ram=500, cpu=0.5), DeploymentRequirement(ram=1000, cpu=0.2), DeploymentRequirement(ram=1000, cpu=0.2), DeploymentRequirement(ram=800, cpu=0.09), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=1006, cpu=0.125), DeploymentRequirement(ram=2256, cpu=2.05), DeploymentRequirement(ram=2256, cpu=2.05), DeploymentRequirement(ram=2256, cpu=2.05), DeploymentRequirement(ram=256, cpu=1), DeploymentRequirement(ram=256, cpu=1), DeploymentRequirement(ram=256, cpu=1), DeploymentRequirement(ram=150, cpu=0.05), DeploymentRequirement(ram=150, cpu=0.05), DeploymentRequirement(ram=150, cpu=0.05), DeploymentRequirement(ram=150, cpu=0.05), DeploymentRequirement(ram=150, cpu=0.05), DeploymentRequirement(ram=150, cpu=0.05), DeploymentRequirement(ram=150, cpu=0.05), DeploymentRequirement(ram=150, cpu=0.05), DeploymentRequirement(ram=150, cpu=0.05), DeploymentRequirement(ram=150, cpu=0.05), DeploymentRequirement(ram=128, cpu=0.05), DeploymentRequirement(ram=2048, cpu=0.5), DeploymentRequirement(ram=2048, cpu=0.5), DeploymentRequirement(ram=2048, cpu=0.5), DeploymentRequirement(ram=2048, cpu=0.5), DeploymentRequirement(ram=2048, cpu=0.5), DeploymentRequirement(ram=0, cpu=0.01), DeploymentRequirement(ram=112, cpu=0.25), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=256, cpu=0.1), DeploymentRequirement(ram=256, cpu=0.4), DeploymentRequirement(ram=256, cpu=0.4), DeploymentRequirement(ram=256, cpu=0.4), DeploymentRequirement(ram=90, cpu=0.1), DeploymentRequirement(ram=250, cpu=0.25), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=3888, cpu=3.072), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=192, cpu=0.2), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=30, cpu=0.1), DeploymentRequirement(ram=656, cpu=0.125), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=1024, cpu=0.256), DeploymentRequirement(ram=1024, cpu=0.256), DeploymentRequirement(ram=1024, cpu=0.256), DeploymentRequirement(ram=500, cpu=0.25), DeploymentRequirement(ram=432, cpu=0.22499999999999998), DeploymentRequirement(ram=16384, cpu=2.048), DeploymentRequirement(ram=2048, cpu=0.256), DeploymentRequirement(ram=1024, cpu=1.024), DeploymentRequirement(ram=750, cpu=0.15), DeploymentRequirement(ram=750, cpu=0.15), DeploymentRequirement(ram=750, cpu=0.15), DeploymentRequirement(ram=2304, cpu=0.55), DeploymentRequirement(ram=2304, cpu=0.55), DeploymentRequirement(ram=2304, cpu=0.55), DeploymentRequirement(ram=1024, cpu=0.5), DeploymentRequirement(ram=1024, cpu=0.5), DeploymentRequirement(ram=1024, cpu=0.25), DeploymentRequirement(ram=1024, cpu=0.25), DeploymentRequirement(ram=1500, cpu=2.048), DeploymentRequirement(ram=1500, cpu=2.048), DeploymentRequirement(ram=2256, cpu=1.05), DeploymentRequirement(ram=2256, cpu=1.05), DeploymentRequirement(ram=2256, cpu=1.05), DeploymentRequirement(ram=100, cpu=0.3), DeploymentRequirement(ram=100, cpu=0.3), DeploymentRequirement(ram=100, cpu=0.3), DeploymentRequirement(ram=2256, cpu=2.05), DeploymentRequirement(ram=2256, cpu=2.05), DeploymentRequirement(ram=2256, cpu=2.05), DeploymentRequirement(ram=1256, cpu=1.55), DeploymentRequirement(ram=1256, cpu=1.55), DeploymentRequirement(ram=1256, cpu=1.55), DeploymentRequirement(ram=4000, cpu=4), DeploymentRequirement(ram=4000, cpu=4), DeploymentRequirement(ram=4000, cpu=4), DeploymentRequirement(ram=2000, cpu=2), DeploymentRequirement(ram=2000, cpu=2), DeploymentRequirement(ram=2000, cpu=2), DeploymentRequirement(ram=256, cpu=1), DeploymentRequirement(ram=2000, cpu=2), DeploymentRequirement(ram=2256, cpu=2.05), DeploymentRequirement(ram=2256, cpu=2.05), DeploymentRequirement(ram=2256, cpu=2.05), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=1756, cpu=2.098), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=288, cpu=0.1), DeploymentRequirement(ram=1280, cpu=1.05), DeploymentRequirement(ram=1280, cpu=1.05), DeploymentRequirement(ram=512, cpu=0.6), DeploymentRequirement(ram=512, cpu=0.6), DeploymentRequirement(ram=512, cpu=0.6), DeploymentRequirement(ram=512, cpu=0.6), DeploymentRequirement(ram=512, cpu=0.6), DeploymentRequirement(ram=512, cpu=0.6), DeploymentRequirement(ram=512, cpu=0.6), DeploymentRequirement(ram=512, cpu=0.6), DeploymentRequirement(ram=1280, cpu=1.05), DeploymentRequirement(ram=1280, cpu=1.05), DeploymentRequirement(ram=256, cpu=0.1), DeploymentRequirement(ram=256, cpu=0.1), DeploymentRequirement(ram=1024, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=1024, cpu=0.075), DeploymentRequirement(ram=1024, cpu=0.075), DeploymentRequirement(ram=1024, cpu=0.075), DeploymentRequirement(ram=506, cpu=0.07), DeploymentRequirement(ram=506, cpu=0.07), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=2000, cpu=2), DeploymentRequirement(ram=32, cpu=0.15), DeploymentRequirement(ram=32, cpu=0.15), DeploymentRequirement(ram=32, cpu=0.15), DeploymentRequirement(ram=2012, cpu=2.3040000000000003), DeploymentRequirement(ram=2012, cpu=2.3040000000000003), DeploymentRequirement(ram=4096, cpu=0.075), DeploymentRequirement(ram=4096, cpu=0.075), DeploymentRequirement(ram=8192, cpu=0.075), DeploymentRequirement(ram=4096, cpu=0.075), DeploymentRequirement(ram=8192, cpu=0.075), DeploymentRequirement(ram=2048, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=500, cpu=0.25), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=750, cpu=0.075), DeploymentRequirement(ram=6144, cpu=6), DeploymentRequirement(ram=6144, cpu=6), DeploymentRequirement(ram=6144, cpu=6), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=70, cpu=0.1), DeploymentRequirement(ram=70, cpu=0.1), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=100, cpu=0.2), DeploymentRequirement(ram=640, cpu=0.5), DeploymentRequirement(ram=640, cpu=0.5), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=0, cpu=0), DeploymentRequirement(ram=500, cpu=0.5), DeploymentRequirement(ram=0, cpu=0)]


model = MipModel(available_instances, requirements)
model.calculate()

# ec2 = boto3.resource('ec2', region_name="us-east-1")
# ami_owners = ['056684691971']
# for ami in ec2.images.filter( Owners=ami_owners, Filters=[ {"Name":"description", "Values":["{*}"]} ] ):
#     release_date = None
#     if ami.description is not None:
#         description = json.loads(ami.description)
#         if description is not None:
#             release_date = description["release_date"]
#
#     print(f"{ami.id}, {ami.description}, {release_date}, {ami.tags}")

